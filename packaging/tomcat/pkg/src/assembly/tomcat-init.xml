<assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0 http://maven.apache.org/xsd/assembly-1.1.0.xsd">

  <id>tomcat</id>
  <includeBaseDirectory>false</includeBaseDirectory>
  <formats>
    <format>dir</format>
  </formats>

  <dependencySets>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/lib</outputDirectory>
      <includes>
        <include>org.slf4j:*:jar</include>
        <include>commons-*:*:jar</include>
        <include>org.jboss*:*:jar</include>
        <include>jboss.*:*:jar</include>
        <include>javassist:*:jar</include>
        <include>jgroups:*:jar</include>
        <include>org.exoplatform.kernel:*:jar</include>
        <include>org.exoplatform.core:*:jar</include>
        <include>org.exoplatform.jcr:*:jar</include>
        <include>org.exoplatform.ws:*:jar</include>
        <include>org.picketlink.idm:*:jar</include>
        <include>org.reflext:*:jar</include>
        <include>org.chromattic:*:jar</include>
        <include>org.gatein.common:*:jar</include>
        <include>org.gatein.wci:*:jar</include>
        <include>org.gatein.pc:*:jar</include>
        <include>org.gatein.mop:*:jar</include>
        <include>org.gatein.shindig:*:jar</include>
        <include>org.gatein.captcha:*:jar</include>
        <include>org.exoplatform.portal:*:jar</include>
        <include>javax.*:*:jar</include>
        <include>org.hibernate:*:jar</include>
        <include>com.google.code.guice:*:jar</include>
        <include>antlr:*:jar</include>
        <include>aopalliance:*:jar</include>
        <include>asm:*:jar</include>
        <include>bouncycastle:*:jar</include>
        <include>caja:*:jar</include>
        <include>cglib:*:jar</include>
        <include>oswego-concurrent:*:jar</include>
        <include>dom4j:*:jar</include>
        <include>net.sf.ehcache:*:jar</include>
        <include>com.jhlabs:*:jar</include>
        <include>com.google.collections:*:jar</include>
        <include>org.codehaus.groovy:*:jar</include>
        <include>hsqldb:*:jar</include>
        <include>html-parser:*:jar</include>
        <include>com.ibm.icu:*:jar</include>
        <include>com.lowagie:*:jar</include>
        <include>net.jcip:*:jar</include>
        <include>jdom:*:jar</include>
        <include>org.jibx:*:jar</include>
        <include>joda-time:*:jar</include>
        <include>rhino:*:jar</include>
        <include>org.jsecurity:*:jar</include>
        <include>org.json:*:jar</include>
        <include>de.odysseus.juel:*:jar</include>
        <include>org.apache.lucene:*:jar</include>
        <include>net.sourceforge.nekohtml:*:jar</include>
        <include>org.apache.pdfbox:*:jar</include>
        <include>picocontainer:*:jar</include>
        <include>org.apache.poi:*:jar</include>
        <include>org.apache.portals.bridges:*:jar</include>
        <include>quartz:*:jar</include>
        <include>rome:*:jar</include>
        <include>org.apache.sanselan:*:jar</include>
        <include>org.apache.ws.commons:*:jar</include>
        <include>xerces:*:jar</include>
        <include>org.apache.xmlbeans:*:jar</include>
        <include>xpp3:*:jar</include>
        <include>com.thoughtworks.xstream:*:jar</include>
        <include>net.oauth:*:jar</include>
        <include>log4j:*:jar</include>
      </includes>
    </dependencySet>

    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>portal.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.web.portal:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>eXoGadgetServer.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.gadgets-server:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>eXoGadgets.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.eXoGadgets:war</include>
      </includes>
    </dependencySet>

    <!-- War files -->
    <!--
    missing : 153019 Oct 23 16:48 gatein-sample-skin.war
    -->

    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>web.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.portlet.web:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>rest.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.web.rest:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>exoadmin.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.portlet.exoadmin:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>eXoResources.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.web.eXoResources:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>dashboard.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.portlet.dashboard:war</include>
      </includes>
    </dependencySet>
    <dependencySet>
      <useTransitiveDependencies>false</useTransitiveDependencies>
      <outputDirectory>tomcat/webapps</outputDirectory>
      <outputFileNameMapping>integration.war</outputFileNameMapping>
      <includes>
        <include>org.exoplatform.portal:exo.portal.packaging.tomcat.integration:war</include>
      </includes>
    </dependencySet>
  </dependencySets>

  <fileSets>

    <!-- Copy tomcat: without unix executables -->
    <fileSet>
      <directory>${tomcat.dir}</directory>
      <outputDirectory>tomcat</outputDirectory>
      <excludes>
        <exclude>bin/*.sh</exclude>
        <exclude>bin/startup.*</exclude>
        <exclude>bin/shutdown.*</exclude>
      </excludes>
      <fileMode>0644</fileMode>
    </fileSet>

    <!-- Copy tomcat: only unix executabls -->
    <fileSet>
      <directory>${tomcat.dir}/bin</directory>
      <outputDirectory>tomcat/bin</outputDirectory>
      <includes>
        <include>*.sh</include>
      </includes>
      <excludes>
        <exclude>startup.*</exclude>
        <exclude>shutdown.*</exclude>
      </excludes>
      <fileMode>0755</fileMode>
    </fileSet>

    <!-- Configurations, etc.-->
    <fileSet>
      <directory>${project.basedir}/src/main/resources/tomcat</directory>
      <outputDirectory>tomcat</outputDirectory>
      <excludes>
        <exclude>bin/*.sh</exclude>
      </excludes>
      <fileMode>0644</fileMode>
    </fileSet>

    <!-- Startup scripts -->
    <fileSet>
      <directory>${project.basedir}/src/main/resources/tomcat/bin</directory>
      <outputDirectory>tomcat/bin</outputDirectory>
      <includes>
        <include>*.sh</include>
      </includes>
      <fileMode>0755</fileMode>
    </fileSet>
  </fileSets>

  <files>
    <!-- Copy gatein configuration file -->
    <!-- Julien : try to improve that -->
    <file>
      <source>${project.basedir}/../../../component/common/src/main/java/conf/configuration-tomcat.properties</source>
      <outputDirectory>tomcat/gatein/conf</outputDirectory>
      <destName>configuration.properties</destName>
    </file>
  </files>

</assembly>
