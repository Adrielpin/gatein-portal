<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<section id="sect-Reference_Guide-Setup_a_Gadget_Server">
   <title>Setup a Gadget Server</title>
   <section
      id="sect-Reference_Guide-Setup_a_Gadget_Server-Setup_virtual_servers_for_the_gadget_rendering">
      <title>Setup virtual servers for the gadget rendering</title>
      <para>
         GateIn recommend you to setup 2 different virtual hosts
         because it's the
         basis of the security model of gadgets. Having
         the gadget
         running on a different domain than the container (the
         website
         that 'contains' the app), the gadget can't read / modify
         / do
         anything nasty to GateIn Portal (like adding spam messages,
         stealing your cookies, whatever).
	</para>
      <para>
         For example you can server the portal from
         <emphasis role="bold">http://www.sample.com</emphasis>
         and the gadgets from
         <emphasis role="bold">http://www.samplemodules.com</emphasis>
      </para>
      <para>
         To do this, we need to configure a parameter with the name is
         <emphasis>gadgets.hostName</emphasis>
         , the value is the
         <emphasis>path/to/gadgetServer</emphasis>
         in GadgetRegisteryService service like following:
         <programlisting><![CDATA[<component>
  <key>org.exoplatform.application.gadget.GadgetRegistryService</key>
  <type>org.exoplatform.application.gadget.jcr.GadgetRegistryServiceImpl</type>
  <init-params>
    <value-param>
      <name>gadgets.hostName</name>
      <description>Gadget server url</description>
      <value>http://localhost:8080/GateInGadgetServer/gadgets/</value>
    </value-param>
  </init-params>
</component>]]></programlisting>
      </para>
      <para>
         It's possible to have multiple rendering servers. That would
         help to
         balance the load across multiple servers.
	</para>
      <para>
         If you still want to deploy it on the same server, make sure
         that it
         starts before anything that use the gadgets (for example
         the
         webapp GateInGadgets that use
         org.exoplatform.application.gadget.GadgetRegister)
	</para>
   </section>
   <section>
      <title>Configuration</title>
      <section>
         <title>Security key</title>
         <para>
            A file
            <emphasis role="bold">key.txt</emphasis>
            has to be generated
            <emphasis role="bold">for every installation of GateIn to
               be
               secure</emphasis>
            . This file contains a secret key used to crypt the security
            token used for authenticating the user. On Linux this can be
            generated such as:
         </para>
         <programlisting>dd if=/dev/random bs=32 count=1  | openssl base64 &gt; /tmp/key.txt</programlisting>
      </section>
      <section>
         <title>Gadget proxy and concat configuration</title>
         <para>These servers have to be on the same domain as the gadget server. You can configure it in: <filename>eXoGadgetServer:/WEB-INF/classes/containers/default/container.js</filename>.
<programlisting><![CDATA["gadgets.content-rewrite" : {
  "include-urls": ".*",
  "exclude-urls": "",
  "include-tags": ["link", "script", "embed", "img", "style"],
  "expires": "86400",
  "proxy-url": "http://localhost:8080/eXoGadgetServer/gadgets/proxy?url=",
  "concat-url": "http://localhost:8080/eXoGadgetServer/gadgets/concat?"
},]]></programlisting> 
	</para>
      </section>
      <section>
         <title>Proxy</title>
   <para>
      if your server is behind a proxy and you want to allow external gadgets, you should configure the proxy of your JVM adding this code at the begining.
   </para>
   <programlisting>-Dhttp.proxyHost=proxyhostURL -Dhttp.proxyPort=proxyPortNumber -Dhttp.proxyUser=someUserName -Dhttp.proxyPassword=somePassword</programlisting>
      </section>

	</section>
</section>


