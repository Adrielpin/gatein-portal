<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../../Reference_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="sect-Reference_Guide-Authentication_Token_Configuration">
	<title>Authentication Token Configuration</title>
	
	<section id="sect-Reference_Guide-Authentication_Token_Configuration-What_is_token_service">
		<title>What is token service</title>
		<para>
			<emphasis>Token service</emphasis> is used in authentication.
		</para>
		<para>
			The token system prevents user account information being sent in clear text mode for inbound requests.  This increases authentication security.
		</para>
		<para>
			Token service allows adminitrators to create, delete, retrieve and clean tokens as required. The service also defines the validity period of any given token. The token becomes invalid once this period has expired, . The life-time definition must be configured.
		</para>
	</section>
	
	<section id="sect-Reference_Guide-Authentication_Token_Configuration-Implement_token_services_API">
		<title>Implement token service's API</title>
		<para>
			All token services used in &PRODUCT;'s authentication must be a subclass of an abstract class <emphasis role="bold">AbstractTokenService</emphasis>. The following example shows how the token-service manipulates its tokens.
		</para>
		
<programlisting role="JAVA">
		public Token getToken(String id) throws PathNotFoundException, RepositoryException;
		public Token deleteToken(String id) throws PathNotFoundException, RepositoryException;
		public String[] getAllTokens();
		public long getNumberTokens() throws Exception;
		public String createToken(Credentials credentials) throws IllegalArgumentException,NullPointerException;
		public Credentials validateToken(String tokenKey, boolean remove) throws NullPointerException;
</programlisting>
		<para>
			
		</para>
	</section>
	
	<section id="sect-Reference_Guide-Authentication_Token_Configuration-Configure_token_services">
		<title>Configure token services</title>
		<para>
			Token services configuration includes specifying the validity period time of token in the configuration file. The token service is configured as a portal component.
		</para>
		<para>
		In the example below, <emphasis>CookieTokenService</emphasis> is a subclass of <emphasis role="bold">AbstractTokenService</emphasis> so it has a property which specifies the validity period of the token.
		</para>
		<para>
			The token service will initiate this validity property by looking for an <parameter>init-param</parameter> named "<emphasis role="bold">service.configuration</emphasis>". 
		</para>
		<para>
			This property must have three values.
		</para>
		<programlistingco>
			<areaspec>
				<area coords="7" id="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-name" />
				<area coords="8" id="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-time" />
				<area coords="9" id="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-unit" />
			</areaspec>

<programlisting role="XML">&lt;component&gt;
  &lt;key&gt;org.exoplatform.web.security.security.CookieTokenService&lt;/key&gt;
  &lt;type&gt;org.exoplatform.web.security.security.CookieTokenService&lt;/type&gt;
  &lt;init-params&gt;
  	&lt;values-param&gt;
      &lt;name&gt;tokenTimeout&lt;/name&gt;          
      &lt;value&gt;jcr-token&lt;/value&gt;
      &lt;value&gt;7&lt;/value&gt;
      &lt;value&gt;DAY&lt;/value&gt;
    &lt;/values-param&gt;    	
  &lt;/init-params&gt;
&lt;/component&gt;
</programlisting>

		<calloutlist>
				<callout arearefs="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-name">
					<para>
						Service name
					</para>
				</callout>
				<callout arearefs="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-time">
					<para>
						Amount of time
					</para>
				</callout>
				<callout arearefs="area-Reference_Guide-Authentication_Token_Configuration-Configure_token_services-unit">
					<para>
						Unit of time
					</para>
				</callout>
		</calloutlist>
		</programlistingco>
		<para>
			In this case, the service's name is "<emphasis role="bold">jcr-token</emphasis>" and the token's expiration time is a week.
		</para>
		<para>
			&PRODUCT; supports <emphasis>four</emphasis> timing units: 
		</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para>
					<parameter>SECOND</parameter>
				</para>
			</listitem>
			<listitem>
				<para>
					<parameter>MINUTE</parameter>
				</para>
			</listitem>
			<listitem>
				<para>
					<parameter>HOUR</parameter>
				</para>
			</listitem>
			<listitem>
				<para>
					<parameter>DAY</parameter>
				</para>
			</listitem>
		</orderedlist>
	</section>
</section>


