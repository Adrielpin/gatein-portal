<!--

    Copyright (C) 2009 eXo Platform SAS.
    
    This is free software; you can redistribute it and/or modify it
    under the terms of the GNU Lesser General Public License as
    published by the Free Software Foundation; either version 2.1 of
    the License, or (at your option) any later version.
    
    This software is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
    Lesser General Public License for more details.
    
    You should have received a copy of the GNU Lesser General Public
    License along with this software; if not, write to the Free
    Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
    02110-1301 USA, or see the FSF site: http://www.fsf.org.

-->

<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook V4.4//EN" "http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd">
<section>
	<title>Use an Existing Portlet Application</title>
	<section>
		<title>Overview</title>
	</section>
	<para>GateIn Portal supports standard Portlet API: JSR 168 and
		JSR 286, this means you can develop your own portlet and deploy them
		into GateIn Portal, but also this means that you can use any existing
		portlet compliant with these specifications.</para>
	<para>This article explains the steps to package, deploy and use a
		portlet in GateIn Portal 2.x.</para>
	<section>
		<title>Web Application Configuration</title>
	</section>
	<para>Configuring the Web Application to have GateIn Portlet
		Container register the portlets.</para>
	<para>The Portlet API defines the deployment descriptor, the
		{style:type=span|font-family=courier new,courier}portlet.xml{style}
		file, that contains the &quot;description&quot; and &quot;configuration&quot; of one or several portlets. However the specification does not define how the portlets are registered and recognized by the portal where they will be used. Each portal software has its own way of doing it, using often a proprietary XML file. GateIn is a big supporter of standards and always tries to avoid proprietary files, so the way you define the integration point between the Portal/Portlet Container and the Portlet application is using some standard servlet and servlet listener entries in the web.xml.</para><para>So the first step to prepare the deployment of a portlet application is to modify the web.xml (this could be done after the deployment also, depending of your application server), and to add the following entry:</para><programlisting>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app&gt;
...
&lt;listener&gt;
&lt;listener-class&gt;org.exoplatform.services.portletcontainer.impl.servlet.PortletApplicationListener&lt;/listener-class&gt;
&lt;/listener&gt;
...
&lt;servlet&gt;
&lt;servlet-name&gt;PortletWrapper&lt;/servlet-name&gt;
&lt;servlet-class&gt;org.exoplatform.services.portletcontainer.impl.servlet.ServletWrapper&lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
&lt;servlet-name&gt;PortletWrapper&lt;/servlet-name&gt;
&lt;url-pattern&gt;/PortletWrapper&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
...
&lt;/web-app&gt;
</programlisting><para>You can now save the file and repackage your Web application (WAR file). Note that in some application servers you can use for example a deployment plan (JSR-88) to add this information during deployment without having to access the archived file directly.</para><para>1 Application Deployment</para><para>Your application is now ready to be deployed in your application server. This operation is specific to the application server that you are using in your environment. Depending of your container the logs will change, but let's see what Apache Tomcat is showing to us in its console when we are deploying our portlet application:</para><programlisting>...
INFO: Deploying web application archive GooglePortlet.war
...
2008/07/25 15:33:58:476 CEST (INFO) portletcontainer - DEPLOYING PORTLET APPLICATION: GooglePortlet
2008/07/25 15:33:58:522 CEST (INFO) portletcontainer - The portlet.xml file valid portlet spec 1
2008/07/25 15:33:58:522 CEST (INFO) portletcontainer - -- read: 1 portlets
2008/07/25 15:33:58:524 CEST (INFO) portletcontainer - DEPLOYED PORTLET APPLICATION: GooglePortlet
...
</programlisting><para>As you can see the application is first deployed in the Web Container, and then the portlets are deployed and registered in the GateIn Portlet Container.</para><para>Now you will see how to refresh your repository and then you can use the portlet.</para>
<section><title>Application Registry Refresh</title></section>
<para>As administrator, or any authorized user, go to the Application Registry to refresh it using the following actions:</para><figure><title>Then update the registry by clicking on the &quot;Import Portlet&quot; button.</title><mediaobject><imageobject><imagedata fileref="images/exo-menu.png" format="PNG"></imagedata></imageobject></mediaobject></figure><para>Up to GateIn Portal 2.2 it looks like this:</para><mediaobject><imageobject><imagedata fileref="images/app-registry-01.png" format="PNG"></imagedata></imageobject></mediaobject><para>In GateIn Portal 2.5 and later the button has moved to the right corner.</para><mediaobject><imageobject><imagedata fileref="images/AutoImport.png" format="PNG"></imagedata></imageobject></mediaobject><para>Your application registry contains now your new portlet that can be dropped on a page or used in WebOS.</para>
</section>