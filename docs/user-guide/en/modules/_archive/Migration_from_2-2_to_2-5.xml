<!--

    Copyright (C) 2009 eXo Platform SAS.
    
    This is free software; you can redistribute it and/or modify it
    under the terms of the GNU Lesser General Public License as
    published by the Free Software Foundation; either version 2.1 of
    the License, or (at your option) any later version.
    
    This software is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
    Lesser General Public License for more details.
    
    You should have received a copy of the GNU Lesser General Public
    License along with this software; if not, write to the Free
    Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
    02110-1301 USA, or see the FSF site: http://www.fsf.org.

-->

<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook V4.4//EN" "http://www.oasis-open.org/docbook/sgml/4.4/docbookx.dtd">
<chapter>
<title>Migration from 2.2 to 2.5</title>
<section><title>Drop legacy support for GateIn Widgets</title></section>
<para>Since Portal 2.5, Google Gadgets are used instead of previously used Widgets. We need to remove configurations and data of Widget from portal.</para>
<section><title>Remove the initial configuration</title></section>
<itemizedlist><listitem>Remove Widget registration</listitem></itemizedlist><para>As we have known, there is a listener to register Widget is org.exoplatform.web.application.ApplicationRegister. So now we should remove it from web.xml of  the web application which contains Widget registration.</para><para>+<emphasis role="bold">Notes</emphasis>+ : By default in portal 2.2.x, we have a GateInWidgetWeb web application to register some widgets like CalendarWidget, StickerWidget, CalculatorWidget v.v.. let remove these web applications from  deploying.</para><itemizedlist><listitem>Remove the pre-configured widgets for user.</listitem></itemizedlist><para>Remove all widgets.xml files which are localed in the configured folder of each user.</para><para>for instance : /WEB-INF/conf/portal/user/demo/widgets.xml</para><itemizedlist><listitem>Remove widgets configuration from page and portal configuration.</listitem></itemizedlist><para>Remove widget layout configuration in pages.xml {code:xml} &lt;widget-layout&gt; ... &lt;/widget-layout&gt; {code}</para><para>and widget application in portal.xml {code:xml} ................ &lt;application&gt; &lt;instance-id&gt;portal#webos:/GateInWidgetWeb/WelcomeWidget/WelcomeWidget&lt;/instance-id&gt; &lt;application-type&gt;GateInWidget&lt;/application-type&gt; &lt;title&gt;Welcome Widget&lt;/title&gt; &lt;/application&gt; ................ {code}</para>
<section><title>Remove existing data of Widgets from JCR</title></section>
<para>We created a service is .... which will detect existing register data of Widget and remove them from JCR.</para>
<section><title>Configure to use Google Gadgets (optional)</title></section>

<section><title>Configure services for Gadgets</title></section>
<para>There are two services GadgetRegistryService and SourceStorage for this :</para><itemizedlist><listitem>GadgetRegistryService provides operation with portal registry and its work is quite similar with ApplicationRegistryService: {code:xml} &lt;component&gt; &lt;key&gt;org.exoplatform.application.gadget.GadgetRegistryService&lt;/key&gt; &lt;type&gt;org.exoplatform.application.gadget.jcr.GadgetRegistryServiceImpl&lt;/type&gt; &lt;init-params&gt; &lt;properties-param&gt; &lt;name&gt;developerInfo&lt;/name&gt; &lt;description&gt;The group that is allowed to develop gadgets&lt;/description&gt; &lt;property name=&quot;developer.group&quot; value=&quot;/platform/administrators&quot;&gt;&lt;/property&gt; &lt;/properties-param&gt; &lt;/init-params&gt; &lt;/component&gt; {code}</listitem></itemizedlist><itemizedlist><listitem>In SourceStorage service configuration, there are three parameters to specify the repository, workspace and root folder where Gadget's resources be located: {code:xml} &lt;component&gt; &lt;key&gt;org.exoplatform.application.gadget.SourceStorage&lt;/key&gt; &lt;type&gt;org.exoplatform.application.gadget.jcr.SourceStorageImpl&lt;/type&gt; &lt;init-params&gt; &lt;properties-param&gt; &lt;name&gt;location&lt;/name&gt; &lt;description&gt;The location store source of gadgets&lt;/description&gt; &lt;property name=&quot;repository&quot; value=&quot;${repositoryName}&quot;&gt;&lt;/property&gt; &lt;property name=&quot;workspace&quot; value=&quot;${workspaceName}&quot;&gt;&lt;/property&gt; &lt;property name=&quot;store.path&quot; value=&quot;{homePath}&quot;&gt;&lt;/property&gt; &lt;/properties-param&gt; &lt;/init-params&gt; &lt;/component&gt; {code}</listitem></itemizedlist>
<section><title>Register Gadgets into GateIn Portal</title></section>
<para>If you want the Portal to detect Gadget from your web application, let configure the listener org.exoplatform.application.gadget.GadgetRegister in the web.xml: {code:xml} &lt;listener&gt; &lt;listener-class&gt; org.exoplatform.application.gadget.GadgetRegister&lt;/listener-class&gt; &lt;/listener&gt; {code}</para><para>Also, there is a file be named gadget.xml that located in the same directory with web.xml file. This specifies gadget xml files that will be registered into Portal. Please refer to http://wiki.exoplatform.com/xwiki/bin/view/Portal/Packaging+Gadgets for more details how to package and configure gadgets.</para><para>1 Separate WebOS from Portal</para><itemizedlist><listitem>Since 2.5, you have to deploy separately WebOS if you want to use Desktop page in your product.</listitem></itemizedlist><para>1 Configure ExoCache implementation (optional)<!-- LB --></para><para>Older versions of Portal was using SimpleExoCache which based on BaseExoCache as default caching. In Kernel 2.1 provided ConcurrentFIFOExoCache which an alternative implementation of ExoCache based on ConcurrentHashMap.</para><para>So if you want to configure CacheSevice to use ConcurrentFIFOExoCache as default ExoCache in conf system of portal war:</para><para>e.g. in /WEB-INF/conf/common/common-configuration.xml file :</para><programlisting>
  .................
  &lt;component&gt;
  	&lt;key&gt;org.exoplatform.services.cache.CacheService&lt;/key&gt;
    &lt;jmx-name&gt;cache:type=CacheService&lt;/jmx-name&gt;
  	&lt;type&gt;org.exoplatform.services.cache.impl.CacheServiceImpl&lt;/type&gt;
  	&lt;init-params&gt;
      &lt;object-param&gt;
        &lt;name&gt;cache.config.default&lt;/name&gt;
        &lt;description&gt;The default cache configuration&lt;/description&gt;
        &lt;object type=&quot;org.exoplatform.services.cache.ExoCacheConfig&quot;&gt;
          &lt;field name=&quot;name&quot;&gt;&lt;string&gt;default&lt;/string&gt;&lt;/field&gt;
          &lt;field name=&quot;maxSize&quot;&gt;&lt;int&gt;300&lt;/int&gt;&lt;/field&gt;
          &lt;field name=&quot;liveTime&quot;&gt;&lt;long&gt;-1&lt;/long&gt;&lt;/field&gt;
          &lt;field name=&quot;distributed&quot;&gt;&lt;boolean&gt;false&lt;/boolean&gt;&lt;/field&gt;
          &lt;field name=&quot;implementation&quot;&gt;&lt;string&gt;org.exoplatform.services.cache.concurrent.ConcurrentFIFOExoCache&lt;/string&gt;&lt;/field&gt; 
        &lt;/object&gt;
      &lt;/object-param&gt;
    &lt;/init-params&gt;	
  &lt;/component&gt;
  .................
</programlisting>
<section><title>Configure Orientation for a language</title></section>
<para>Portal 2.5 is released with supporting Arabic language, it also means that Portal supports to display in Right To Left. To configure a language to be displayed in RTL, just specifies the orientation as &quot;rt&quot; ( Right To ) for it. By default, the &quot;lt&quot; orientation will be used.</para><para>Here is the example for configuration in /WEB-INF/conf/common/locales-config.xml:</para><programlisting>
	&lt;locale-config&gt;
		&lt;locale&gt;fr&lt;/locale&gt;
		&lt;output-encoding&gt;UTF-8&lt;/output-encoding&gt;
		&lt;input-encoding&gt;UTF-8&lt;/input-encoding&gt;
		&lt;description&gt;Default configuration for the french locale&lt;/description&gt;
		&lt;orientation&gt;lt&lt;/orientation&gt;
	&lt;/locale-config&gt;
  
	&lt;locale-config&gt;
		&lt;locale&gt;ar&lt;/locale&gt;
		&lt;output-encoding&gt;UTF-8&lt;/output-encoding&gt;
		&lt;input-encoding&gt;UTF-8&lt;/input-encoding&gt;
		&lt;description&gt;Default configuration for the arabic locale&lt;/description&gt;
		&lt;orientation&gt;rt&lt;/orientation&gt;
	&lt;/locale-config&gt;
</programlisting><para>1 Convention for navigation configuration</para><para>In navigation.xml configuration files, there is a constraint in node definition between url and name fields is the last snippet ( separated by forward slash '/' ) of uri should be the same with the name.</para><para>For instance : {code:xml} &lt;node&gt; &lt;uri&gt;organization/newStaff&lt;/uri&gt; &lt;name&gt;newStaff&lt;/name&gt; &lt;label&gt;#{organization.newstaff}&lt;/label&gt; &lt;page-reference&gt;group::organization/management/executive-board::newStaff&lt;/page-reference&gt; &lt;/node&gt; {code} In above example, let make sure that the newStaff will be the same and case sensitive in the both of uri and name fields.</para>
<section><title>Remove the factory-id in portal configuration</title></section>
<para>The factory-id field in portal configuration is not be used anymore, so we should remove this in portal.xml files.</para>
<section><title>Configure the ResourceRequestFilter filter</title></section>
<para>This configuration is to handle stylesheets and images with RTL. To make you web application be handled with RTL framework, let configure the ResourceRequestFilter filter in the web.xml to make sure that the filter will handle the stylesheet and image requests. {code:xml} &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceRequestFilter&lt;/filter-name&gt; &lt;url-pattern&gt;<emphasis role="bold">.css&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceRequestFilter&lt;/filter-name&gt; &lt;url-pattern&gt;</emphasis>.gif&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceRequestFilter&lt;/filter-name&gt; &lt;url-pattern&gt;<emphasis role="bold">.png&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceRequestFilter&lt;/filter-name&gt; &lt;url-pattern&gt;</emphasis>.jpg&lt;/url-pattern&gt; &lt;/filter-mapping&gt; {code}</para>
</chapter>